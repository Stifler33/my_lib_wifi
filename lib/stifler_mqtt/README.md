## README: stifler_mqtt üöÄ

–≠—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è MQTT-–∫–ª–∏–µ–Ω—Ç–æ–º (–Ω–∞ –±–∞–∑–µ **PubSubClient**) –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö ESP32/ESP8266, —É–ø—Ä–æ—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫—É, –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ —Ç–æ–ø–∏–∫–∏ —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–æ–º –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–ª—è —Ä–∞–±–æ—Ç—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è:

  * **PubSubClient**
  * **GTimer**
  * **Preferences**
  * **WiFi**

-----

### üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### 1\. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–æ–∫–µ—Ä–∞ (–∞–¥—Ä–µ—Å, –ø–æ—Ä—Ç, –ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ **Flash-–ø–∞–º—è—Ç–∏** –ø–æ–¥ –∫–ª—é—á–æ–º `config_mqtt`.

–í—ã–∑–æ–≤–∏—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –≤ `setup()` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞:

```cpp
void init_brocker();
```

#### 2\. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¢–æ–ø–∏–∫–æ–≤ –¥–ª—è –ü—É–±–ª–∏–∫–∞—Ü–∏–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `add_pub_topic` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è **–ø–æ–ª–Ω–æ–≥–æ –∏–º–µ–Ω–∏ —Ç–æ–ø–∏–∫–∞**, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. –î–æ—Å—Ç—É–ø –∫ –ø–æ–ª–Ω–æ–º—É –∏–º–µ–Ω–∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É `name_topic`:

```cpp
/**
 * @param name_topic –ö–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è —Ç–æ–ø–∏–∫–∞ (–∫–ª—é—á –≤ –∫–∞—Ä—Ç–µ pub_topics).
 * @param topic –ü–æ–ª–Ω–æ–µ –∏–º—è —Ç–æ–ø–∏–∫–∞ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.
 */
void add_pub_topic(String name_topic, const char* topic);

// –ü—Ä–∏–º–µ—Ä:
add_pub_topic("status", "my_device/status");
// –ü—É–±–ª–∏–∫–∞—Ü–∏—è: client.publish(pub_topics["status"], "ONLINE"); 
```

#### 3\. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¢–æ–ø–∏–∫–æ–≤ –¥–ª—è –ü–æ–¥–ø–∏—Å–∫–∏ –∏ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `add_sub_topic` –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Ç–æ–ø–∏–∫ –∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –µ–≥–æ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º. –§—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —ç—Ç–æ–º —Ç–æ–ø–∏–∫–µ.

```cpp
/**
 * @param name_topic –ö–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è —Ç–æ–ø–∏–∫–∞ (–∫–ª—é—á –≤ –∫–∞—Ä—Ç–µ sub_topics).
 * @param topic –ü–æ–ª–Ω–æ–µ –∏–º—è —Ç–æ–ø–∏–∫–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏.
 * @param handler –§—É–Ω–∫—Ü–∏—è —Ç–∏–ø–∞ void(), –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.
 */
void add_sub_topic(String name_topic, const char* topic, std::function<void()> handler = nullptr);

// –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞:
void on_command() {
    Serial.println("–ö–æ–º–∞–Ω–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!");
    // –í–∞–∂–Ω–æ: –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ payload —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
}

// –ü—Ä–∏–º–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
add_sub_topic("cmd", "my_device/cmd", on_command);
```

#### 4\. –û—Å–Ω–æ–≤–Ω–æ–π –¶–∏–∫–ª

–§—É–Ω–∫—Ü–∏—è `loop_mqtt()` –¥–æ–ª–∂–Ω–∞ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–º —Ü–∏–∫–ª–µ `loop()` –≤–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã. –û–Ω–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±—Ä–æ–∫–µ—Ä—É.

```cpp
void loop() {
    // ... –≤–∞—à –∫–æ–¥
    loop_mqtt();
    // ... –≤–∞—à –∫–æ–¥
}
```